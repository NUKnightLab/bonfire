<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation &mdash; Bonfire 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Bonfire 0.1 documentation" href="index.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="Bonfire documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Bonfire documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Bonfire 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>Within the cloned repo, run:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install .
</pre></div>
</div>
<p>This will install the bonfire command line tool and dependencies.</p>
</div>
<div class="section" id="elasticsearch">
<h1>Elasticsearch<a class="headerlink" href="#elasticsearch" title="Permalink to this headline">¶</a></h1>
<p>For information about installing Elasticsearch, please go to <a class="reference external" href="http://elasticsearch.org">http://elasticsearch.org</a>.</p>
</div>
<div class="section" id="configuration">
<h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>Bonfire comes with some example universes built-in. To see the configuration, and add your own universe configuration, run <tt class="docutils literal"><span class="pre">bonfire</span> <span class="pre">config</span></tt>. You will need to have your EDITOR environment variable set for this command to work.</p>
<p>Each universe defined by a <tt class="docutils literal"><span class="pre">[universe:&lt;universe-name&gt;]</span></tt> section in the configuration file should have its own Twitter application credentials set for <tt class="docutils literal"><span class="pre">twitter_consumer_key</span></tt>, <tt class="docutils literal"><span class="pre">twitter_consumer_secret</span></tt>, <tt class="docutils literal"><span class="pre">twitter_access_token</span></tt>, and <tt class="docutils literal"><span class="pre">twitter_access_token_secret</span></tt>. To setup your Twitter applications, login to the Twitter developer console with your Twitter account at <a class="reference external" href="https://dev.twitter.com/">https://dev.twitter.com/</a>.</p>
</div>
<div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>To create an editable local deployment for development (ideally within
a virtualenvironment):</p>
<div class="highlight-python"><div class="highlight"><pre>pip install --editable .
</pre></div>
</div>
<p>This will install the bonfire command line tool, and dependencies.</p>
</div>
<div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>To run all tests:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py test
</pre></div>
</div>
<p>To test a specific module:</p>
<div class="highlight-python"><div class="highlight"><pre>python -m unittest tests.test_universe
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<p>Parameters in the [logging] section of the bonfire configuration file are passed to a basicConfig logging configuration. These include</p>
<blockquote>
<div><ul class="simple">
<li>filename</li>
<li>level</li>
<li>filemode</li>
<li>format</li>
<li>datefmt</li>
</ul>
</div></blockquote>
<p>If the [logging] section includes an option called <tt class="docutils literal"><span class="pre">configfile</span></tt>, the specified file will be used to setup a fileConfig instead of the basic config. Remaining parameters listed above will be passed to fileConfig as defaults. An example logging config file is provided called <tt class="docutils literal"><span class="pre">logging.conf.example</span></tt>.</p>
</div>
<div class="section" id="flask-web-application">
<h1>Flask Web Application<a class="headerlink" href="#flask-web-application" title="Permalink to this headline">¶</a></h1>
<p>There is an example web application in bonfire/web/flaskapp. To run this you will need to install Flask: <tt class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">flask</span></tt>.</p>
</div>
<div class="section" id="deployment">
<h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h1>
<p>It is recommended that you run the bonfire processes via a process manager. The following demonstrates Upstart usage for Ubuntu.</p>
<div class="section" id="upstart">
<h2>Upstart<a class="headerlink" href="#upstart" title="Permalink to this headline">¶</a></h2>
<p>The following example shows use of upstart with bonfire being executed by a user called <tt class="docutils literal"><span class="pre">apps</span></tt> within a virtual environment at <tt class="docutils literal"><span class="pre">/home/apps/env/bonfire</span></tt>. The virtualenv sets the <tt class="docutils literal"><span class="pre">BONFIRE_CONFIG</span></tt> environment variable to <tt class="docutils literal"><span class="pre">/etc/bonfire.cfg</span></tt>. The bonfire.cfg file has a logging section that looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>[logging]
filename=/var/log/bonfire.log
level=WARNING
</pre></div>
</div>
<p>/etc/init/bonfire-collect.conf</p>
<div class="highlight-python"><div class="highlight"><pre>start on filesystem and net-device-up IFACE=lo

stop on shutdown

respawn

script
  . /home/apps/env/bonfire/bin/activate
  exec bonfire collect journotech
end script
</pre></div>
</div>
<p>/etc/init/bonfire-process.conf</p>
<div class="highlight-python"><div class="highlight"><pre>start on filesystem and net-device-up IFACE=lo

stop on shutdown

respawn

script
  . /home/apps/env/bonfire/bin/activate
  exec bonfire process journotech
end script
</pre></div>
</div>
<p>You can then control the bonfire services with:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service bonfire-collect [start|stop|restart]
</pre></div>
</div>
</div>
<div class="section" id="troublehooting-upstart">
<h2>Troublehooting Upstart<a class="headerlink" href="#troublehooting-upstart" title="Permalink to this headline">¶</a></h2>
<p>If your Upstart services seem to be running, but you aren&#8217;t seeing any Tweets or any logs, be sure to check the upstart logs. E.g: /var/log/upstart/bonfire-collect.log</p>
</div>
<div class="section" id="troubleshooting-the-bonfire-collector">
<h2>Troubleshooting the Bonfire collector<a class="headerlink" href="#troubleshooting-the-bonfire-collector" title="Permalink to this headline">¶</a></h2>
<p>The Twitter stream can be a bit finicky and the collector has been known stop collecting even when the stream connection remains open. Firstly, be sure to run the collector in a process manager, as described above. Secondly, it might be useful to monitor the raw tweet queue and occasionally restart the collector process if the queue is empty. The following example shows restarting the collector, configured as in the above examples with upstart. This script can be run with cron to periodically check the queue.</p>
<p>/home/apps/sites/bonfire/monitor.py</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">bonfire.db</span> <span class="kn">import</span> <span class="n">get_latest_raw_tweet</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">get_latest_raw_tweet</span><span class="p">(</span><span class="s">&#39;journotech&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;bonfire collect queue not empty&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;restarting bonfire collect&#39;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s">&#39;service bonfire-collect restart&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>/etc/cron.d/bonfire</p>
<div class="highlight-python"><div class="highlight"><pre>PYTHONPATH=/home/apps/sites/bonfire
BONFIRE_CONFIG=/etc/bonfire.cfg

*/15 * * * * root cd /home/apps/sites/bonfire; /home/apps/env/bonfire/bin/python monitor.py  &gt;&gt; /home/apps/log/bonfire/bonfire_monitor.log 2&gt;&amp;1
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation</a></li>
<li><a class="reference internal" href="#elasticsearch">Elasticsearch</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#development">Development</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#flask-web-application">Flask Web Application</a></li>
<li><a class="reference internal" href="#deployment">Deployment</a><ul>
<li><a class="reference internal" href="#upstart">Upstart</a></li>
<li><a class="reference internal" href="#troublehooting-upstart">Troublehooting Upstart</a></li>
<li><a class="reference internal" href="#troubleshooting-the-bonfire-collector">Troubleshooting the Bonfire collector</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Bonfire documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api.html"
                        title="next chapter">API Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/general.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Bonfire documentation"
             >previous</a> |</li>
        <li><a href="index.html">Bonfire 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Northwestern University Knight Lab &amp; Nieman Journalism Lab.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>